<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TheCFG TheBeat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="w-screen h-screen flex items-center justify-center bg-[#2d3748]">

<div class="w-full max-w-7xl h-full max-h-[900px] flex flex-col md:flex-row rounded-2xl shadow-2xl overflow-hidden">
    <!-- Game Area -->
    <div id="game-area" class="w-full md:w-1/2 h-1/2 md:h-full bg-black relative flex justify-center transition-all duration-300">
        <div id="lanes-container" class="h-full flex relative">
            <!-- Lanes will be generated here -->
        </div>
        <div id="judgement-text-container" class="absolute inset-0 pointer-events-none">
            <div id="judgement-text" class="judgement-text"></div>
            <div id="combo-text" class="combo-text"></div>
            <div id="countdown-text" class="countdown-text"></div>
        </div>
    </div>

    <!-- UI Area -->
    <div id="ui-area" class="w-full md:w-1/2 h-1/2 md:h-full p-8 flex flex-col justify-start bg-[#2d3748] overflow-y-auto transition-all duration-300">
        <!-- Menu Screen -->
        <div id="menu-screen" class="flex flex-col flex-shrink-0">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-white"><a href="http://the-cfg.kro.kr">TheBeat v1.99</a></h1>
                <button id="settings-icon-menu" class="p-2 rounded-full hover:bg-gray-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
            <p class="text=l font-bold mb-8 text-white">2025/09/22 20:20 snapshot</p>
            <div id="menu-message" class="hidden p-3 mb-4 text-center text-white bg-red-500 rounded-lg"></div>

            <div class="space-y-6">
                <div>
                    <h3 class="text-xl mb-2 text-gray-300">게임 모드</h3>
                    <div class="flex space-x-2 btn-group" id="mode-selector">
                        <button data-mode="random" class="w-full py-3 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition active">랜덤 모드</button>
                        <button data-mode="music" class="w-full py-3 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition">뮤직 모드</button>
                    </div>
                </div>

                <div id="music-mode-controls" class="hidden mt-2 space-y-2">
                    <div class="flex space-x-2">
                        <label for="chart-file-input" class="cursor-pointer text-center block w-full py-2 px-4 bg-blue-600 hover:bg-blue-500 rounded-lg transition">차트 불러오기</label>
                        <input type="file" id="chart-file-input" class="hidden" accept=".json,application/json">
                        <label for="music-file-input" class="cursor-pointer text-center block w-full py-2 px-4 bg-teal-600 hover:bg-teal-500 rounded-lg transition">음악 불러오기</label>
                        <input type="file" id="music-file-input" class="hidden" accept="audio/*,.mp3,.wav,.ogg">
                    </div>
                    <p id="chart-file-name" class="text-sm text-gray-400 truncate"></p>
                    <p id="music-file-name" class="text-sm text-gray-400 truncate"></p>
                    <p id="required-music-file-name" class="text-sm text-yellow-400 truncate h-5"></p>
                </div>

                <div id="note-count-container">
                    <h3 class="text-xl mb-2 text-gray-300">노트 수 (랜덤 모드)</h3>
                    <input type="number" id="note-count-input" value="100" min="10" max="500" class="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="개수는 최소 10개에서 최대 500개까지 사용 가능합니다.">
                </div>
                <div id="difficulty-controls">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl text-gray-300">난이도</h3>
                            <button id="toggle-details-btn" class="p-1 rounded-full hover:bg-gray-600 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                        </div>
                        <div class="flex space-x-2 btn-group" id="difficulty-selector">
                            <button data-difficulty="easy" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">쉬움</button>
                            <button data-difficulty="normal" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition active">보통</button>
                            <button data-difficulty="hard" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">어려움</button>
                        </div>
                    </div>
                    
                    <div id="detailed-difficulty-settings" class="hidden mt-4 p-4 bg-gray-800 rounded-lg space-y-4">
                        <div>
                            <div class="flex justify-between items-center text-gray-300">
                                <label for="note-speed-slider">노트 속도</label>
                                <span id="note-speed-value" class="font-mono">7</span>
                            </div>
                            <input id="note-speed-slider" type="range" min="1" max="20" value="7" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <div class="flex justify-between items-center text-gray-300">
                                <label for="dongta-prob-slider">동시타 확률</label>
                                <span id="dongta-prob-value" class="font-mono">25%</span>
                            </div>
                            <input id="dongta-prob-slider" type="range" min="0" max="100" value="25" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <div class="flex justify-between items-center text-gray-300">
                                <label for="long-note-prob-slider">롱노트 확률</label>
                                <span id="long-note-prob-value" class="font-mono">15%</span>
                            </div>
                            <input id="long-note-prob-slider" type="range" min="0" max="100" value="15" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div class="border-t border-gray-700 pt-4 space-y-4">
                            <div class="flex items-center justify-between text-gray-300">
                                <label for="false-note-toggle">가짜 노트 활성화</label>
                                <input id="false-note-toggle" type="checkbox" class="h-5 w-5 bg-gray-700 rounded border-gray-600 text-blue-500 focus:ring-blue-500">
                            </div>
                    
                            <div id="false-note-prob-container" class="hidden">
                                <div class="flex justify-between items-center text-gray-300">
                                    <label for="false-note-prob-slider">가짜 노트 등장 확률</label>
                                    <span id="false-note-prob-value" class="font-mono">0%</span>
                                </div>
                                <input id="false-note-prob-slider" type="range" min="0" max="500" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl mb-2 text-gray-300">레인 수</h3>
                    <select id="lanes-selector" class="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="4" selected>4 레인</option>
                        <option value="5">5 레인</option>
                        <option value="6">6 레인</option>
                        <option value="7">7 레인</option>
                        <option value="8">8 레인</option>
                    </select>
                </div>

                <div class="mt-10 space-y-3">
                    <button id="start-game-btn" class="w-full py-4 text-xl font-bold bg-green-600 hover:bg-green-500 rounded-lg transition">게임 시작</button>
                    <button id="editor-btn" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 rounded-lg transition">에디터</button>
                </div>
            </div>
        </div>

        <!-- Playing Screen -->
        <div id="playing-screen" class="hidden h-full flex flex-col justify-between">
            <div>
                <div class="flex justify-between items-center mb-4">
                    <h2 id="playing-status-label" class="text-3xl font-bold text-white">플레이 중</h2>
                    <button id="settings-icon-playing" class="p-2 rounded-full hover:bg-gray-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4 text-lg">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-400">점수</p>
                        <p id="score" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-400">콤보</p>
                        <p id="combo" class="text-3xl font-bold">0</p>
                    </div>
                </div>
                <div class="mt-4 bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-xl mb-2 text-gray-300">판정</h3>
                    <div class="space-y-1 text-lg">
                        <p>PERFECT: <span id="perfect-count">0</span></p>
                        <p>GOOD: <span id="good-count">0</span></p>
                        <p>BAD: <span id="bad-count">0</span></p>
                        <p>MISS: <span id="miss-count">0</span></p>
                    </div>
                </div>
            </div>
            <div class="space-y-3 mt-auto">
                <div id="pause-resume-container">
                    <button id="pause-game-btn" class="w-full py-3 text-lg font-bold bg-yellow-600 hover:bg-yellow-500 rounded-lg transition">일시 정지</button>
                    <button id="resume-game-btn" class="hidden w-full py-3 text-lg font-bold bg-green-600 hover:bg-green-500 rounded-lg transition">계속하기</button>
                </div>
                <button id="give-up-btn" class="w-full py-3 text-lg font-bold bg-red-600 hover:bg-red-500 rounded-lg transition">포기하기</button>
            </div>
        </div>
        
        <div id="settings-screen" class="hidden h-full flex flex-col justify-between">
            <div class="flex-grow flex flex-col min-h-0">
                <h2 class="text-3xl font-bold mb-4 text-white">환경설정</h2>
                
                <div id="settings-tabs" class="flex border-b border-gray-600 mb-4">
                    <button data-tab="volume" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition active">음량</button>
                    <button data-tab="controls" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition">조작</button>
                    <button data-tab="help" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition">도움말</button>
                    <button data-tab="etc" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition">기타</button>
                </div>
                
                <div class="flex-grow space-y-6 overflow-y-auto">
                    <div id="tab-content-volume" class="tab-content space-y-6">
                        <div>
                            <div class="flex justify-between items-center text-gray-300 mb-2">
                                <label for="volume-slider-music">음악 볼륨</label>
                                <span id="volume-value-music" class="font-mono">100</span>
                            </div>
                            <input id="volume-slider-music" type="range" min="0" max="100" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <div class="flex justify-between items-center text-gray-300 mb-2">
                                <label for="volume-slider-sfx">효과음 볼륨</label>
                                <span id="volume-value-sfx" class="font-mono">100</span>
                            </div>
                            <input id="volume-slider-sfx" type="range" min="0" max="100" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                    
                    <div id="tab-content-controls" class="tab-content hidden space-y-4 text-gray-300">
                        <!-- [수정된 부분] 키 바인딩 UI 순서 수정 -->
                        <div class="grid grid-cols-2 gap-x-8 gap-y-3">
                            <span class="text-right">좌측 4</span> <div class="keybind-box" data-key-id="L4"></div>
                            <span class="text-right">좌측 3</span> <div class="keybind-box" data-key-id="L3"></div>
                            <span class="text-right">좌측 2</span> <div class="keybind-box" data-key-id="L2"></div>
                            <span class="text-right">좌측 1</span> <div class="keybind-box" data-key-id="L1"></div>
                            <span class="text-right">중앙</span>   <div class="keybind-box" data-key-id="C1"></div>
                            <span class="text-right">우측 1</span> <div class="keybind-box" data-key-id="R1"></div>
                            <span class="text-right">우측 2</span> <div class="keybind-box" data-key-id="R2"></div>
                            <span class="text-right">우측 3</span> <div class="keybind-box" data-key-id="R3"></div>
                            <span class="text-right">우측 4</span> <div class="keybind-box" data-key-id="R4"></div>
                        </div>
                        <div class="pt-4 text-center">
                            <p id="keybind-status-label" class="h-6 text-yellow-400"></p>
                            <button id="save-keybinds-btn" class="mt-2 w-full max-w-xs py-2 bg-blue-600 hover:bg-blue-500 rounded transition">저장</button>
                        </div>
                    </div>
                    
                    <div id="tab-content-help" class="tab-content hidden space-y-6 text-gray-300 text-sm">
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">1. 플레이 방법 및 화면 조작</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>기본 목표:</strong> 화면 위에서 아래로 내려오는 노트를 판정선에 맞춰 정확한 타이밍에 처리하는 리듬 게임입니다.</li>
                                <li><strong>조작:</strong> 각 레인(세로줄)에 해당하는 키보드 키를 눌러 노트를 처리합니다. 기본 조작키는 '환경설정 > 조작' 탭에서 변경할 수 있습니다.</li>
                                <li><strong>일시정지:</strong> 게임 플레이 중 <kbd class="px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg">ESC</kbd> 키를 누르거나 일시 정시 버튼을 누르면 게임을 일시정지하거나 다시 시작할 수 있습니다.</li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">2. 노트의 종류</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong class="text-blue-400">일반 노트 (파란색):</strong> 가장 기본적인 노트입니다. 판정선에 맞춰 한 번 누르면 처리됩니다.</li>
                                <li><strong class="text-purple-400">롱노트 (보라색):</strong> 긴 막대 형태의 노트입니다. 시작 지점에서 키를 누른 상태를 유지하고, 끝 지점에서 정확하게 키를 떼야 합니다.</li>
                                <li><strong class="text-red-400">가짜 노트 (붉은색):</strong> 함정 노트입니다. 절대로 누르지 말고 그대로 통과시켜야 PERFECT 판정을 받으며, 잘못 누르면 MISS가 됩니다.</li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">3. 점수 계산과 종료 화면</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>판정:</strong> 정확도에 따라 PERFECT, GOOD, BAD, MISS 네 가지로 나뉩니다. GOOD 이상의 판정은 콤보를 쌓고 점수를 줍니다.</li>
                                <li><strong>콤보:</strong> 연속으로 GOOD 이상 판정을 받으면 콤보가 쌓이며, 높은 콤보는 더 많은 추가 점수를 제공합니다.</li>
                                <li><strong>종료 화면:</strong> 곡이 끝나면 최종 점수, 판정별 노트 수, 그리고 성과에 따른 최종 랭크(S, A, B, C)가 표시됩니다.</li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">4. 메인 메뉴 설정 가이드</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>게임 모드:</strong> '랜덤 모드'와 직접 만든 차트를 플레이하는 '뮤직 모드'를 선택할 수 있습니다.</li>
                                <li><strong>레인 수 조정:</strong> 4레인부터 8레인까지 원하는 플레이 환경을 선택할 수 있습니다.</li>
                                <li><strong>난이도 조절 (랜덤 모드 전용):</strong>
                                    <ul class="list-circle list-inside ml-4">
                                        <li><strong>간단 설정:</strong> '쉬움', '보통', '어려움' 버튼으로 간편하게 난이도를 선택합니다.</li>
                                        <li><strong>세부 설정:</strong> 화살표 아이콘을 눌러 노트 속도, 동시타/롱노트/가짜 노트의 등장 확률을 세밀하게 조절할 수 있습니다.</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">5. 환경설정 (톱니바퀴 아이콘)</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>음량:</strong> 배경 음악(BGM)과 효과음(SFX)의 크기를 각각 조절합니다.</li>
                                <li><strong>조작:</strong> 게임 플레이에 사용할 키를 직접 설정합니다. 변경 후에는 반드시 '저장' 버튼을 눌러야 적용됩니다.</li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">6. 에디터 사용법</h3>
                            <p>자신만의 차트를 만드는 공간입니다.</p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><strong>기본 설정:</strong> 음악 파일, BPM(곡 빠르기), 음악 시작 시간(초)을 설정합니다. 차트를 저장하려면 반드시 음악 파일을 먼저 불러와야 합니다.</li>
                                <li><strong>노트 배치:</strong> 상단 버튼으로 노트 종류를 선택한 뒤, 타임라인의 원하는 위치를 클릭하여 노트를 배치하거나 삭제할 수 있습니다.</li>
                                <li><strong>마디 조절:</strong> '+'와 '-' 버튼으로 차트의 전체 길이를 자유롭게 조절할 수 있습니다.</li>
                                <li><strong>관리:</strong> '재생/정지'로 차트를 미리 확인하고, '저장/열기'로 작업 내용을 관리합니다. '재설정'은 배치된 노트를 모두 삭제합니다.</li>
                            </ul>
                        </div>
                    
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">7. 문의</h3>
                            <p>버그 리포트 및 기타 문의는 디스코드 서버 또는 개인 DM으로 연락 바랍니다.</p>
                        </div>
                    </div>
                    
                    <div id="tab-content-etc" class="tab-content hidden">
                        <div>
                            <h3 class="text-xl font-semibold mb-2 text-white">디버그 모드</h3>
                            <div class="flex items-center justify-between text-sm">
                                <label for="debug-mode-toggle">디버그 오버레이 활성화</label>
                                <input id="debug-mode-toggle" type="checkbox" class="h-5 w-5 bg-gray-700 rounded border-gray-600 text-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <h3 class="text-xl font-semibold mb-2 text-white">정보</h3>
                            <div class="text-gray-400 text-sm space-y-1">
                                <p>(c) 2025 TheCFG All Rights Reserved.</p>
                                <p>Dedicated by TheCFG,</p>
                                <p>Created with Google AI Studio,</p>
                                <p>Published with Netlify,</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="settings-back-btn" class="w-full py-3 text-lg font-bold bg-gray-600 hover:bg-gray-500 rounded-lg transition mt-4 flex-shrink-0">돌아가기</button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden h-full flex flex-col justify-center items-center text-center">
            <h2 class="text-5xl font-bold mb-4 text-white">게임 결과</h2>
            <div class="w-full bg-gray-700 p-6 rounded-lg">
                <p class="text-2xl text-gray-400 mb-2">최종 점수</p>
                <p id="final-score" class="text-6xl font-bold mb-6">0</p>
                <p class="text-2xl text-gray-400 mb-2">랭크</p>
                <p id="rank" class="text-7xl font-bold text-yellow-400 mb-8">C</p>
                <div class="grid grid-cols-2 gap-4 text-xl">
                    <p>PERFECT: <span id="final-perfect">0</span></p>
                    <p>GOOD: <span id="final-good">0</span></p>
                    <p>BAD: <span id="final-bad">0</span></p>
                    <p>MISS: <span id="final-miss">0</span></p>
                </div>
            </div>
            <button id="back-to-menu-btn" class="mt-8 w-full max-w-sm py-4 text-xl font-bold bg-blue-600 hover:bg-blue-500 rounded-lg transition">메인으로 돌아가기</button>
        </div>

        <!-- Editor Screen -->
        <div id="editor-screen" class="hidden flex flex-col h-full text-white">
            <div class="flex-shrink-0">
                <h2 class="text-3xl font-bold mb-4">차트 에디터</h2>
                <div id="editor-message" class="hidden p-3 mb-4 text-center bg-red-500 rounded-lg"></div>
        
                <!-- 상단 컨트롤 영역 -->
                <div class="grid grid-cols-3 gap-4 p-4 bg-gray-800 rounded-lg">
                    <!-- 1. 음악 설정 -->
                    <div class="flex flex-col space-y-2">
                        <h3 class="text-lg font-semibold border-b border-gray-600 pb-1">음악 설정</h3>
                        <div class="flex items-center space-x-2">
                            <label for="audio-file-input-editor" class="cursor-pointer text-center flex-1 py-2 px-3 bg-teal-600 hover:bg-teal-500 rounded transition text-sm">음악 불러오기</label>
                            <input type="file" id="audio-file-input-editor" accept="audio/*" class="hidden">
                            <span id="audio-file-name-editor" class="text-xs text-gray-400 flex-1 truncate">선택된 파일 없음</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="editor-start-time" class="text-sm">시작(초):</label>
                            <input type="number" id="editor-start-time" value="0" min="0" class="w-20 p-1 bg-gray-700 rounded text-sm">
                        </div>
                        <!-- [수정] 재생/정지 버튼을 이곳으로 이동 -->
                        <div class="flex items-center space-x-2 pt-1">
                            <button id="editor-play-btn" class="flex-1 py-1 px-2 bg-green-600 hover:bg-green-500 rounded text-sm">재생</button>
                            <button id="editor-stop-btn" class="flex-1 py-1 px-2 bg-gray-500 hover:bg-gray-400 rounded text-sm">정지</button>
                        </div>
                    </div>
                
                    <!-- 2. 차트 설정 (변경 없음) -->
                    <div class="flex flex-col space-y-2">
                        <h3 class="text-lg font-semibold border-b border-gray-600 pb-1">차트 설정</h3>
                        <div class="flex items-center space-x-2">
                            <label for="bpm-input" class="text-sm">BPM:</label>
                            <input type="number" id="bpm-input" value="120" class="w-20 p-1 bg-gray-700 rounded text-sm">
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm">마디:</label>
                            <button id="editor-add-measure-btn" class="px-2 py-0.5 bg-gray-600 hover:bg-gray-500 rounded text-sm">+</button>
                            <button id="editor-remove-measure-btn" class="px-2 py-0.5 bg-gray-600 hover:bg-gray-500 rounded text-sm">-</button>
                        </div>
                        <div id="editor-note-type-selector" class="flex space-x-2 btn-group pt-1">
                            <button data-type="tap" class="w-10 h-8 bg-blue-500 hover:bg-blue-400 rounded transition active"></button>
                            <button data-type="long" class="w-10 h-8 bg-purple-500 hover:bg-purple-400 rounded transition"></button>
                            <button data-type="false" class="w-10 h-8 bg-red-400 hover:bg-red-300 rounded transition"></button>
                        </div>
                    </div>
                
                    <!-- 3. 관리 -->
                    <div class="flex flex-col space-y-2">
                         <h3 class="text-lg font-semibold border-b border-gray-600 pb-1">관리</h3>
                         <!-- [수정] 저장 버튼과 파일명 입력 칸 추가 -->
                         <div class="flex items-center space-x-2">
                            <input type="text" id="editor-chart-filename" placeholder="파일명" class="flex-grow p-1 bg-gray-700 rounded text-sm min-w-0">
                            <button id="editor-save-btn" class="py-1 px-2 bg-blue-600 hover:bg-blue-500 rounded text-sm">저장</button>
                         </div>
                         <div class="grid grid-cols-2 gap-2 pt-1">
                            <button id="editor-load-btn" class="py-1 px-2 bg-purple-600 hover:bg-purple-500 rounded text-sm">열기</button>
                            <button id="editor-reset-btn" class="py-1 px-2 bg-red-700 hover:bg-red-600 rounded text-sm">재설정</button>
                            <button id="editor-back-btn" class="col-span-2 py-1 px-2 bg-gray-600 hover:bg-gray-500 rounded text-sm">메인 메뉴</button>
                         </div>
                    </div>
                </div>
                <p id="editor-status-label" class="text-yellow-400 text-center h-5 mt-2"></p>
            </div>
        
            <!-- 악보 편집 영역 -->
            <div class="flex-grow relative bg-black min-h-0 mt-4" id="editor-container">
                <div id="editor-timeline">
                    <div id="editor-grid-container"></div>
                    <div id="editor-notes-container">
                        <div id="editor-playhead"></div>
                    </div>
                </div>
            </div>
            <input type="file" id="editor-load-input" class="hidden" accept=".json">
        </div>
    </div>
</div>

<div id="debug-overlay" class="hidden">
    <h3 class="title">디버그 모드</h3>
    <div class="debug-content-area">
        <!-- 1. 성능 프로파일러 섹션 -->
        <div class="debug-section">
            <h4 class="debug-section-title">성능</h4>
            <div id="debug-perf-container" class="debug-container"></div>
        </div>
        <!-- 2. 실시간 상태 뷰어 섹션 -->
        <div class="debug-section">
            <h4 class="debug-section-title">게임 상태 (실시간)</h4>
            <div id="debug-state-container" class="debug-container">
                <pre></pre>
            </div>
        </div>
        <!-- 3. 에러 로그 섹션 -->
        <div class="debug-section">
            <h4 class="debug-section-title">에러 로그</h4>
            <div id="debug-log-container" class="debug-container"></div>
        </div>
    </div>
</div>
    
<audio id="music-player"></audio>

<!-- JavaScript Files -->
<script defer src="js/config.js"></script>
<script defer src="js/dom.js"></script>
<script defer src="js/audio.js"></script>
<script defer src="js/ui.js"></script>
<script defer src="js/editor.js"></script>
<script defer src="js/game.js"></script>
<script defer src="js/main.js"></script>

</body>
</html>
