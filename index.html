<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TheCFG TheBeat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="w-screen h-screen flex items-center justify-center bg-[#2d3748]">

<div class="w-full max-w-7xl h-full max-h-[900px] flex flex-col md:flex-row rounded-2xl shadow-2xl overflow-hidden">
    <!-- Game Area -->
    <div id="game-area" class="w-full md:w-1/2 h-1/2 md:h-full bg-black relative flex justify-center transition-all duration-300">
        <div id="lanes-container" class="h-full flex relative">
            <!-- Lanes will be generated here -->
        </div>
        <div id="judgement-text-container" class="absolute inset-0 pointer-events-none">
            <div id="judgement-text" class="judgement-text"></div>
            <div id="combo-text" class="combo-text"></div>
            <div id="countdown-text" class="countdown-text"></div>
        </div>
    </div>

    <!-- UI Area -->
    <div id="ui-area" class="w-full md:w-1/2 h-1/2 md:h-full p-8 flex flex-col justify-start bg-[#2d3748] overflow-y-auto transition-all duration-300">
        <!-- Menu Screen -->
        <div id="menu-screen" class="flex flex-col flex-shrink-0">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold text-white"><a href="http://the-cfg.kro.kr">TheBeat v1.8</a></h1>
                <!-- [추가] 환경설정 아이콘 버튼 (메뉴) -->
                <button id="settings-icon-menu" class="p-2 rounded-full hover:bg-gray-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
            <p class="text=l font-bold mb-8 text-white">2025/09/18 21:17 snapshot</p>
            <div id="menu-message" class="hidden p-3 mb-4 text-center text-white bg-red-500 rounded-lg"></div>

            <div class="space-y-6">
                <div>
                    <h3 class="text-xl mb-2 text-gray-300">게임 모드</h3>
                    <div class="flex space-x-2 btn-group" id="mode-selector">
                        <button data-mode="random" class="w-full py-3 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition active">랜덤 모드</button>
                        <button data-mode="music" class="w-full py-3 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition">뮤직 모드</button>
                    </div>
                </div>

                <div id="music-mode-controls" class="hidden mt-2 space-y-2">
                    <div class="flex space-x-2">
                        <label for="chart-file-input" class="cursor-pointer text-center block w-full py-2 px-4 bg-blue-600 hover:bg-blue-500 rounded-lg transition">차트 불러오기</label>
                        <input type="file" id="chart-file-input" class="hidden" accept=".json">
                        <label for="music-file-input" class="cursor-pointer text-center block w-full py-2 px-4 bg-teal-600 hover:bg-teal-500 rounded-lg transition">음악 불러오기</label>
                        <input type="file" id="music-file-input" class="hidden" accept="audio/*">
                    </div>
                    <p id="chart-file-name" class="text-sm text-gray-400 truncate"></p>
                    <p id="music-file-name" class="text-sm text-gray-400 truncate"></p>
                </div>

                <div id="note-count-container">
                    <h3 class="text-xl mb-2 text-gray-300">노트 수 (랜덤 모드)</h3>
                    <input type="number" id="note-count-input" value="100" min="10" max="500" class="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl text-gray-300">난이도</h3>
                        <button id="toggle-details-btn" class="p-1 rounded-full hover:bg-gray-600 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex space-x-2 btn-group" id="difficulty-selector">
                        <button data-difficulty="easy" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">쉬움</button>
                        <button data-difficulty="normal" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition active">보통</button>
                        <button data-difficulty="hard" class="w-full py-3 px-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">어려움</button>
                    </div>
                </div>
                
                <div id="detailed-difficulty-settings" class="hidden mt-4 p-4 bg-gray-800 rounded-lg space-y-4">
                    <div>
                        <div class="flex justify-between items-center text-gray-300">
                            <label for="note-speed-slider">노트 속도</label>
                            <span id="note-speed-value" class="font-mono">7</span>
                        </div>
                        <input id="note-speed-slider" type="range" min="1" max="20" value="7" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div>
                        <div class="flex justify-between items-center text-gray-300">
                            <label for="dongta-prob-slider">동시타 확률</label>
                            <span id="dongta-prob-value" class="font-mono">25%</span>
                        </div>
                        <input id="dongta-prob-slider" type="range" min="0" max="100" value="25" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div>
                        <div class="flex justify-between items-center text-gray-300">
                            <label for="long-note-prob-slider">롱노트 확률</label>
                            <span id="long-note-prob-value" class="font-mono">15%</span>
                        </div>
                        <input id="long-note-prob-slider" type="range" min="0" max="100" value="15" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <div>
                  <h3 class="text-xl mb-2 text-gray-300">레인 수</h3>
                  <select id="lanes-selector" class="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                      <option value="4" selected>4 레인</option>
                      <option value="5">5 레인</option>
                      <option value="6">6 레인</option>
                      <option value="7">7 레인</option>
                      <option value="8">8 레인</option>
                  </select>
                </div>

                <div class="mt-10 space-y-3">
                    <button id="start-game-btn" class="w-full py-4 text-xl font-bold bg-green-600 hover:bg-green-500 rounded-lg transition">게임 시작</button>
                    <button id="editor-btn" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 rounded-lg transition">에디터</button>
                </div>
            </div>
        </div>

        <!-- Playing Screen -->
        <div id="playing-screen" class="hidden h-full flex flex-col justify-between">
            <div>
                <div class="flex justify-between items-center mb-4">
                    <h2 id="playing-status-label" class="text-3xl font-bold text-white">플레이 중</h2>
                    <!-- [추가] 환경설정 아이콘 버튼 (플레이 중) -->
                    <button id="settings-icon-playing" class="p-2 rounded-full hover:bg-gray-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4 text-lg">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-400">점수</p>
                        <p id="score" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-400">콤보</p>
                        <p id="combo" class="text-3xl font-bold">0</p>
                    </div>
                </div>
                <div class="mt-4 bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-xl mb-2 text-gray-300">판정</h3>
                    <div class="space-y-1 text-lg">
                        <p>PERFECT: <span id="perfect-count">0</span></p>
                        <p>GOOD: <span id="good-count">0</span></p>
                        <p>BAD: <span id="bad-count">0</span></p>
                        <p>MISS: <span id="miss-count">0</span></p>
                    </div>
                </div>
            </div>
            <div class="space-y-3 mt-auto">
                <div id="pause-resume-container">
                    <button id="pause-game-btn" class="w-full py-3 text-lg font-bold bg-yellow-600 hover:bg-yellow-500 rounded-lg transition">일시 정지</button>
                    <button id="resume-game-btn" class="hidden w-full py-3 text-lg font-bold bg-green-600 hover:bg-green-500 rounded-lg transition">계속하기</button>
                </div>
                <button id="give-up-btn" class="w-full py-3 text-lg font-bold bg-red-600 hover:bg-red-500 rounded-lg transition">포기하기</button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden h-full flex flex-col justify-center items-center text-center">
             <h2 class="text-5xl font-bold mb-4 text-white">게임 결과</h2>
            <div class="w-full bg-gray-700 p-6 rounded-lg">
                <p class="text-2xl text-gray-400 mb-2">최종 점수</p>
                <p id="final-score" class="text-6xl font-bold mb-6">0</p>
                <p class="text-2xl text-gray-400 mb-2">랭크</p>
                <p id="rank" class="text-7xl font-bold text-yellow-400 mb-8">C</p>
                <div class="grid grid-cols-2 gap-4 text-xl">
                    <p>PERFECT: <span id="final-perfect">0</span></p>
                    <p>GOOD: <span id="final-good">0</span></p>
                    <p>BAD: <span id="final-bad">0</span></p>
                    <p>MISS: <span id="final-miss">0</span></p>
                </div>
            </div>
            <button id="back-to-menu-btn" class="mt-8 w-full max-w-sm py-4 text-xl font-bold bg-blue-600 hover:bg-blue-500 rounded-lg transition">메인으로 돌아가기</button>
        </div>

        <!-- Editor Screen -->
        <div id="editor-screen" class="hidden flex flex-col h-full">
            <h2 class="text-3xl font-bold mb-4 text-white">차트 에디터</h2>
            <div id="editor-message" class="hidden p-3 mb-4 text-center text-white bg-red-500 rounded-lg"></div>
            <div class="flex-grow flex flex-col space-y-4 overflow-hidden">
                <div class="flex items-center space-x-4">
                    <input type="file" id="audio-file-input-editor" accept="audio/*" class="hidden">
                    <label for="audio-file-input-editor" class="cursor-pointer text-center flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition">음악 파일 선택</label>
                    <span id="audio-file-name-editor" class="text-sm text-gray-400 flex-1 truncate">선택된 파일 없음</span>
                </div>
                <div class="flex items-center space-x-4">
                    <label for="bpm-input" class="text-lg">BPM:</label>
                    <input type="number" id="bpm-input" value="120" class="w-24 p-2 bg-gray-700 rounded">
                    <div id="editor-lanes-selector" class="flex space-x-2 btn-group">
                        <button data-lanes="4" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg transition active">4L</button>
                        <button data-lanes="5" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg transition">5L</button>
                        <button data-lanes="7" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded-lg transition">7L</button>
                    </div>
                </div>
                <div class="flex-grow relative bg-black min-h-0" id="editor-container">
                    <div id="editor-timeline" class="h-full">
                        <div id="editor-playhead"></div>
                    </div>
                </div>
                <input type="file" id="editor-load-input" class="hidden" accept=".json">
                <div class="flex space-x-4 mt-2">
                    <button id="editor-play-pause-btn" class="w-full py-2 bg-green-600 hover:bg-green-500 rounded">재생</button>
                    <button id="editor-load-btn" class="w-full py-2 bg-purple-600 hover:bg-purple-500 rounded">불러오기</button>
                    <button id="editor-save-btn" class="w-full py-2 bg-blue-600 hover:bg-blue-500 rounded">저장</button>
                    <button id="editor-back-btn" class="w-full py-2 bg-gray-600 hover:bg-gray-500 rounded">메인 메뉴로</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="settings-screen" class="hidden h-full flex flex-col">
    <h2 class="text-3xl font-bold mb-4 text-white">환경설정</h2>

    <!-- 탭 네비게이션 -->
    <div id="settings-tabs" class="flex border-b border-gray-600 mb-4">
        <button data-tab="volume" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition active">음량</button>
        <button data-tab="help" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition">도움말</button>
        <button data-tab="etc" class="tab-btn py-2 px-4 text-gray-300 hover:text-white transition">기타</button>
    </div>

    <!-- 탭 컨텐츠 -->
    <div class="flex-grow space-y-6 overflow-y-auto">
        <!-- 음량 탭 -->
        <div id="tab-content-volume" class="tab-content space-y-6">
            <div>
                <div class="flex justify-between items-center text-gray-300 mb-2">
                    <label for="volume-slider-music">음악 볼륨</label>
                    <span id="volume-value-music" class="font-mono">100</span>
                </div>
                <input id="volume-slider-music" type="range" min="0" max="100" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>
            <div>
                <div class="flex justify-between items-center text-gray-300 mb-2">
                    <label for="volume-slider-sfx">효과음 볼륨</label>
                    <span id="volume-value-sfx" class="font-mono">100</span>
                </div>
                <input id="volume-slider-sfx" type="range" min="0" max="100" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>
        <!-- 도움말 탭 -->
        <div id="tab-content-help" class="tab-content hidden space-y-4 text-gray-300">
            <div>
                <h3 class="text-xl font-semibold mb-2 text-white">기본 조작</h3>
                <p>각 레인에 해당하는 키를 눌러 내려오는 노트를 처리하세요.</p>
                <ul class="list-disc list-inside mt-2">
                    <li>4키: D, F, J, K</li>
                    <li>5키: D, F, Space, J, K</li>
                    <li>6키: S, D, F, J, K, L</li>
                    <li>7키: S, D, F, Space, J, K, L</li>
                    <li>8키: A, S, D, F, J, K, L. ;</li>
                    <li>추후 수정으로 키 사용자 설정을 넣을 예정입니다.</li>
                </ul>
            </div>
             <div>
                <h3 class="text-xl font-semibold mb-2 text-white">일시정지</h3>
                <p>게임 플레이 중 우측 상단의 '일시 정지' 버튼 또는 'ESC' 키를 눌러 게임을 잠시 멈출 수 있습니다.</p>
            </div>
        </div>
        <!-- 기타 탭 -->
        <div id="tab-content-etc" class="tab-content hidden">
            <h3 class="text-xl font-semibold mb-2 text-white">개발자 모드</h3>
            <p class="text-gray-400">추후 업데이트 예정입니다.</p>
        </div>
    </div>
    
    <button id="settings-back-btn" class="w-full py-3 text-lg font-bold bg-blue-600 hover:bg-blue-500 rounded-lg transition mt-auto">돌아가기</button>
</div>

<audio id="music-player"></audio>

<!-- JavaScript Files -->
<script defer src="js/config.js"></script>
<script defer src="js/dom.js"></script>
<script defer src="js/audio.js"></script>
<script defer src="js/ui.js"></script>
<script defer src="js/editor.js"></script>
<script defer src="js/game.js"></script>
<script defer src="js/main.js"></script>

</body>
</html>
